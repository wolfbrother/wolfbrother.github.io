---
dtindex: 2019-09-1348-不用加
date: 2019-09-13
title: 剑指48-不用加减乘除做加法
categories: 剑指offer
tags:  
author: wolfbrother  
---

题目描述

写一个函数，求两个整数之和，要求在函数体内不得使用+、-、*、/四则运算符号。

----------------------

首先看十进制是如何做加法的的： 5+7=12，三步走

+ 第一步：相加各位的值，不算进位，得到2。
+ 第二步：计算进位值，得到10. 如果这一步的进位值为0，那么第一步得到的值就是最终结果。
+ 第三步：重复上述两步，只是相加的值变成上述两步的得到的结果2和10，得到12。

同样我们可以用三步走的方式计算二进制值相加： 5-101，7-111 

+ 第一步：相加各位的值，不算进位，得到010，二进制每位相加就相当于各位做异或操作，101^111。
+ 第二步：计算进位值，得到1010，相当于各位做与操作得到101，再向左移一位得到1010，(101&111)<<1。
+ 重复上述两步， 各位相加 010^1010=1000，进位值为100=(010&1010)<<1。
+ 继续重复上述两步：1000^100 = 1100，进位值为0，跳出循环，1100为最终结果

下面的代码忠实地执行了上述步骤，但不能很好地处理负数，可能会陷入死循环。

```python
class Solution:
    def Add(self, num1, num2):
        if num1 is None or num2 is None:
            return -1
        while num2 != 0:
            num1, num2 = num1^num2, (num1&num2)<<1
        return num1
```

而上述代码的C++或Java版本是没有上述问题的。原因在于：左移操作（即将一个数的二进制位整体向左移若干位，移位后在低位补零，高位溢出部分舍弃），在Python语言里的实现是不完善的，属于历史问题。

改进版代码稍作修改，避免了上述问题，可以处理各种正负数情形，但看不懂原理（[链接](https://blog.csdn.net/s1314p/article/details/95769392 )）：

```python
class Solution: 
    def Add(self, num1, num2):           
        while(num2): 
            num1,num2 = (num1^num2) & 0xFFFFFFFF,((num1&num2)<<1) & 0xFFFFFFFF
        return num1 if num1<=0x7FFFFFFF else ~(num1^0xFFFFFFFF)
```
